{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/mbti/result.css') }}">
<div class="mbti-result">
    <h1>MBTI 결과</h1>
    <ul id="product">
        <li id="product-name"></li>
    </ul>
    <p><span id="product-description"></span></p>
    
    <h2>잘 맞는</h2>
    <ul id="compatibility-good-list">
    </ul>
    
    <h2>안 맞는</h2>
    <ul id="compatibility-bad-list">
    </ul>

    <h2>특징</h2>
    <ul id="environment-list">
    </ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const resultData = localStorage.getItem('mbtiResult');
        if (resultData) {
            const data = JSON.parse(resultData);
            document.getElementById('product-name').textContent = data.product_info.product;
            document.getElementById('product-description').textContent = data.product_info.description;

            const compatibilityGoodList = document.getElementById('compatibility-good-list');
            const compatibilityBadList = document.getElementById('compatibility-bad-list');
            compatibilityGoodList.innerHTML = '';
            compatibilityBadList.innerHTML = '';

            // compatibility
            data.compatibility_info.forEach(info => {
                const listItem = document.createElement('li');
                listItem.textContent = info.product;
                if (info.compatibility === 'good') {
                    compatibilityGoodList.appendChild(listItem);
                } else if (info.compatibility === 'bad') {
                    compatibilityBadList.appendChild(listItem);
                }
            });

            // Good
            if (compatibilityGoodList.children.length === 0) {
                const emptyItem = document.createElement('li');
                emptyItem.textContent = '없음';
                compatibilityGoodList.appendChild(emptyItem);
            }

            // Bad
            if (compatibilityBadList.children.length === 0) {
                const emptyItem = document.createElement('li');
                emptyItem.textContent = '없음';
                compatibilityBadList.appendChild(emptyItem);
            }

            // environment
            const environmentList = document.getElementById('environment-list');
            environmentList.innerHTML = '';
            data.environment_info.forEach(info => {
                const listItem = document.createElement('li');
                listItem.textContent = info.environment;
                environmentList.appendChild(listItem);
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
    const resultData = localStorage.getItem('mbtiResult');
        if (resultData) {
            const data = JSON.parse(resultData);

            const backgroundImageUrl = data.product_info.image; // 실제 경로는 데이터에 따라 다름
            const imageUrl = `/static/${backgroundImageUrl}`;
            // .mbti-result에 배경 이미지 동적으로 설정
            const mbtiResultElement = document.querySelector('.mbti-result');
            mbtiResultElement.style.backgroundImage = `url('${imageUrl}')`;
            mbtiResultElement.style.backgroundSize = 'cover'; // 이미지가 div를 꽉 채우도록 설정
            mbtiResultElement.style.position = 'relative'; // 가상 요소 포지셔닝을 위함
            mbtiResultElement.style.overflow = 'hidden'; // 둥근 모서리 처리를 위함
        }
    });
</script>
</body>
{% endblock %}